<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>nodejs | JoyHolmes博客</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="前端学习笔记">
    
    <link rel="preload" href="/joyholmes-web-blog/assets/css/0.styles.1cb4ca87.css" as="style"><link rel="preload" href="/joyholmes-web-blog/assets/js/app.7eb37b69.js" as="script"><link rel="preload" href="/joyholmes-web-blog/assets/js/3.ccf8db39.js" as="script"><link rel="preload" href="/joyholmes-web-blog/assets/js/1.3b1cd4a9.js" as="script"><link rel="preload" href="/joyholmes-web-blog/assets/js/14.e65b058a.js" as="script"><link rel="prefetch" href="/joyholmes-web-blog/assets/js/10.2899f87d.js"><link rel="prefetch" href="/joyholmes-web-blog/assets/js/11.2b5d8072.js"><link rel="prefetch" href="/joyholmes-web-blog/assets/js/12.667c80ee.js"><link rel="prefetch" href="/joyholmes-web-blog/assets/js/13.1bd247e4.js"><link rel="prefetch" href="/joyholmes-web-blog/assets/js/15.6e2edf41.js"><link rel="prefetch" href="/joyholmes-web-blog/assets/js/16.d15163d9.js"><link rel="prefetch" href="/joyholmes-web-blog/assets/js/17.521d5855.js"><link rel="prefetch" href="/joyholmes-web-blog/assets/js/18.f3d93d71.js"><link rel="prefetch" href="/joyholmes-web-blog/assets/js/19.147524ef.js"><link rel="prefetch" href="/joyholmes-web-blog/assets/js/20.282eab32.js"><link rel="prefetch" href="/joyholmes-web-blog/assets/js/21.6a9bc17b.js"><link rel="prefetch" href="/joyholmes-web-blog/assets/js/22.1a0b77b3.js"><link rel="prefetch" href="/joyholmes-web-blog/assets/js/23.68f1a384.js"><link rel="prefetch" href="/joyholmes-web-blog/assets/js/24.38074801.js"><link rel="prefetch" href="/joyholmes-web-blog/assets/js/25.efe8443f.js"><link rel="prefetch" href="/joyholmes-web-blog/assets/js/26.2e0b268a.js"><link rel="prefetch" href="/joyholmes-web-blog/assets/js/27.8585f5bb.js"><link rel="prefetch" href="/joyholmes-web-blog/assets/js/4.d4d7a181.js"><link rel="prefetch" href="/joyholmes-web-blog/assets/js/5.e0a97d89.js"><link rel="prefetch" href="/joyholmes-web-blog/assets/js/6.8d6a2560.js"><link rel="prefetch" href="/joyholmes-web-blog/assets/js/7.1d99cced.js"><link rel="prefetch" href="/joyholmes-web-blog/assets/js/8.ba57595f.js"><link rel="prefetch" href="/joyholmes-web-blog/assets/js/9.7a493893.js">
    <link rel="stylesheet" href="/joyholmes-web-blog/assets/css/0.styles.1cb4ca87.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-7dd95ae2><div data-v-7dd95ae2><div class="password-shadow password-wrapper-out" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>JoyHolmes博客</h3> <p class="description" data-v-59e6cb88>前端学习笔记</p> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><!---->
          
        <!---->
        2023
      </a></span></div></div> <div class="hide" data-v-7dd95ae2><header class="navbar" data-v-7dd95ae2><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/joyholmes-web-blog/" class="home-link router-link-active"><!----> <span class="site-name">JoyHolmes博客</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/joyholmes-web-blog/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      JoyHolmes的博客
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/joyholmes" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-7dd95ae2></div> <aside class="sidebar" data-v-7dd95ae2><div class="personal-info-wrapper" data-v-1fad0c41 data-v-7dd95ae2><!----> <!----> <div class="num" data-v-1fad0c41><div data-v-1fad0c41><h3 data-v-1fad0c41>18</h3> <h6 data-v-1fad0c41>文章</h6></div> <div data-v-1fad0c41><h3 data-v-1fad0c41>0</h3> <h6 data-v-1fad0c41>标签</h6></div></div> <ul class="social-links" data-v-1fad0c41></ul> <hr data-v-1fad0c41></div> <nav class="nav-links"><div class="nav-item"><a href="/joyholmes-web-blog/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      JoyHolmes的博客
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/joyholmes" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/joyholmes-web-blog/" class="sidebar-heading clickable router-link-active"><span>欢迎学习</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/joyholmes-web-blog/" aria-current="page" class="sidebar-link">学前必读</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/joyholmes-web-blog/network/network" class="sidebar-heading clickable"><span>前端网络知识</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/joyholmes-web-blog/network/network.html" class="sidebar-link">前端网络</a></li><li><a href="/joyholmes-web-blog/network/browser.html" class="sidebar-link">浏览器知识</a></li><li><a href="/joyholmes-web-blog/network/http.html" class="sidebar-link">http相关</a></li><li><a href="/joyholmes-web-blog/network/linux.html" class="sidebar-link">常用Linux命令</a></li><li><a href="/joyholmes-web-blog/network/websocket.html" class="sidebar-link">WebSocket</a></li><li><a href="/joyholmes-web-blog/network/axios.html" class="sidebar-link">axios</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/joyholmes-web-blog/htmlcss/html" class="sidebar-heading clickable"><span>html&amp;css查漏补缺</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/joyholmes-web-blog/htmlcss/html.html" class="sidebar-link">html</a></li><li><a href="/joyholmes-web-blog/htmlcss/css.html" class="sidebar-link">css</a></li><li><a href="/joyholmes-web-blog/htmlcss/css2.html" class="sidebar-link">常用前端布局</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/joyholmes-web-blog/javascript/js" class="sidebar-heading clickable open"><span>js查漏补缺</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/joyholmes-web-blog/javascript/js.html" class="sidebar-link">js基本知识</a></li><li><a href="/joyholmes-web-blog/javascript/nodejs.html" aria-current="page" class="active sidebar-link">node</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/joyholmes-web-blog/vue/vue" class="sidebar-heading clickable"><span>vue</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/joyholmes-web-blog/vue/vue.html" class="sidebar-link">vue基本知识</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/joyholmes-web-blog/web/webpack" class="sidebar-heading clickable"><span>前端工程化</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/joyholmes-web-blog/web/webpack.html" class="sidebar-link">webpack</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/joyholmes-web-blog/ts/typescript" class="sidebar-heading clickable"><span>TypeScript</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/joyholmes-web-blog/ts/typescript.html" class="sidebar-link">TypeScript</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/joyholmes-web-blog/project/project" class="sidebar-heading clickable"><span>项目相关内容</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/joyholmes-web-blog/project/project.html" class="sidebar-link">项目优化</a></li><li><a href="/joyholmes-web-blog/project/others.html" class="sidebar-link">其他内容</a></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>nodejs</h3> <!----> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><!---->
          
        <!---->
        2023
      </a></span></div></div> <div data-v-7dd95ae2><div data-v-7dd95ae2><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">nodejs</h1> <div data-v-8a445198><i class="iconfont reco-account" data-v-8a445198><span data-v-8a445198>JoyHolmes</span></i> <i class="iconfont reco-date" data-v-8a445198><span data-v-8a445198>2023/10/30</span></i> <!----> <!----></div></div> <div class="theme-reco-content content__default"><h1 id="nodejs"><a href="#nodejs" class="header-anchor">#</a> nodejs</h1> <h2 id="nodejs-的事件循环"><a href="#nodejs-的事件循环" class="header-anchor">#</a> nodejs 的事件循环</h2> <p><a href="https://cloud.tencent.com/developer/article/1870700" target="_blank" rel="noopener noreferrer">一张图带你搞懂 Node 事件循环<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><img src="/joyholmes-web-blog/assets/img/cc3ad99a10dce2a930024b2af73a9ae2.e0284944.png" alt=""></p> <p><img src="/joyholmes-web-blog/assets/img/78e439c6adbc9a3e6db332fe8fc52cda.31bc32f8.png" alt=""></p> <p>（1）Timers（计时器阶段）：初次进入事件循环，会从计时器阶段开始。此阶段会判断是否存在过期的计时器回调（包含 setTimeout 和 setInterval），如果存在则会执行所有过期的计时器回调，执行完毕后，如果回调中触发了相应的微任务，会接着执行所有微任务，执行完微任务后再进入 Pending callbacks 阶段。</p> <p>（2）Pending callbacks：执行推迟到下一个循环迭代的I / O回调（系统调用相关的回调）。</p> <p>（3）Idle/Prepare：仅供内部使用。</p> <p>（4）Poll（轮询阶段）：</p> <ul><li>当回调队列不为空时：会执行回调，若回调中触发了相应的微任务，这里的微任务执行时机和其他地方有所不同，不会等到所有回调执行完毕后才执行，而是针对每一个回调执行完毕后，就执行相应微任务。执行完所有的回调后，变为下面的情况。</li> <li>当回调队列为空时（没有回调或所有回调执行完毕）：但如果存在有计时器（setTimeout、setInterval和setImmediate）没有执行，会结束轮询阶段，进入 Check 阶段。否则会阻塞并等待任何正在执行的I/O操作完成，并马上执行相应的回调，直到所有回调执行完毕。</li></ul> <p>（5）Check（查询阶段）：会检查是否存在 setImmediate 相关的回调，如果存在则执行所有回调，执行完毕后，如果回调中触发了相应的微任务，会接着执行所有微任务，执行完微任务后再进入 Close callbacks 阶段。</p> <p>（6）Close callbacks：执行一些关闭回调，比如socket.on('close', ...)等。</p> <p>上面都是 macrotask 的执行情况，对于 microtask 来说，它会在以上每个阶段完成前清空 microtask 队列，下图中的 Tick 就代表了 microtask：</p> <p><img src="/joyholmes-web-blog/assets/img/nodetaskqueue.254fcbc4.jpg" alt=""></p> <h2 id="js-消息队列"><a href="#js-消息队列" class="header-anchor">#</a> js 消息队列</h2> <ol><li>在执行栈中执行一个宏任务。</li> <li>在执行过程中遇到微任务和宏任务，分别添加到微任务队列和宏任务队列中去。</li> <li>当前宏任务执行完毕，立即执行微任务队列中的任务（微任务存在优先级，优先级高的先执行）。</li> <li>当前微任务队列中的任务执行完毕，检查渲染，GUI 线程接管渲染。</li> <li>继续执行下一个宏任务从事件队列中取。</li></ol> <blockquote><p>同步任务 &gt; 微任务(Vue.nextTick (此时 DOM 所有更改已经完成，数据上已经是最新的 DOM，只是还没有进项页面渲染)) &gt; requestAnimationFrame &gt; DOM 渲染 &gt; 宏任务</p></blockquote> <h2 id="node-常用內置模块"><a href="#node-常用內置模块" class="header-anchor">#</a> node 常用內置模块</h2> <h3 id="fs-文件系统模块"><a href="#fs-文件系统模块" class="header-anchor">#</a> fs 文件系统模块</h3> <ol><li>fs.readFile(path[, option], callback)</li> <li>fs.writeFile(path,data[,option], callback)</li> <li>__dirname 表示当前文件所处的目录</li></ol> <h3 id="path-路径模块"><a href="#path-路径模块" class="header-anchor">#</a> path 路径模块</h3> <ol><li>path.join(...paths) 把多个路径片段拼接为完整的路径字符串，凡是涉及路径拼接的操作，都要使用 path.join()方法，使用+拼接库会有./符号导致报错。</li> <li>path.basename(path[,ext])获取路径中的最后一部分，经常用来获取路径中的文件名。</li> <li>path.extname(path) 获取路径中的扩展名。</li></ol> <h3 id="http-模块"><a href="#http-模块" class="header-anchor">#</a> http 模块</h3> <p>通过 http 模块提供的 http.creatServer()方法，为外部提供 web 资源服务。</p> <div class="language- extra-class"><pre class="language-text"><code>const http = require('http')
const server = http.createServer()

server.on('request',(req,res)=&gt;{
  ...
  res.setHeader('Content-Type', 'text/plain; charset=utf-8')
  res.end(&quot;Hello&quot;)
})

server.listen(8080,()=&gt;{})
</code></pre></div><h3 id="net-模块"><a href="#net-模块" class="header-anchor">#</a> net 模块</h3> <p><a href="https://zhuanlan.zhihu.com/p/67606418" target="_blank" rel="noopener noreferrer">net 模块与通讯的实现<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
net 模块中有两大主要抽象概念——net.Server 和 net.Socket：</p> <p>Socket 是对 TCP/IP 协议族的一种封装，是应用层与 TCP/IP 协议族通信的中间软件抽象层。它把复杂的 TCP/IP 协议族隐藏在 Socket 接口后面，对用户来说，一组简单的接口就是全部，让 Socket 去组织数据，以符合指定的协议。</p> <p>Socket 还可以认为是一种网络间不同计算机上的进程通信的一种方法，利用三元组（ip 地址，协议，端口）就可以唯一标识网络中的进程，网络中的进程通信可以利用这个标志与其它进程进行交互。</p> <p>简单地说，net.Server 实例可以监听一个端口（用于实现客户端 TCP 连接通讯）或者地址（用于实现 IPC 跨进程通讯），net.Socket 实例可以建立一个套接字实例，它可以用来和 server 建立连接，连接建立后，就可以实现通讯了。你可以将 socket 想象成手机，把 server 想象成基站，虽然不是很贴切，但可以降低理解难度。</p> <ol><li>server 的建立
服务器是 net.Server 类的实例，通过 net.createServer([options][,onConnection] )方法建立，如果传入一个函数，则这个函数会作为 connection 事件的回调函数，当一个 socket 实例连接到 server 时，connection 事件就会触发，回调函数中的形参就指向了发起连接的 socket 实例。server 实例并不能独立工作，作为网络服务器使用时需要需要调用 listen 方法来监听一个地址，示例如下：</li></ol> <div class="language- extra-class"><pre class="language-text"><code>const net = require('net');
const { StringDecoder } = require('string_decoder');
let decoder = new StringDecoder('utf8');

let server = net.createServer(socket=&gt;{
   console.log('接收连接');
   socket.on('data',data=&gt;{
       console.log('收到来自客户端的消息:',decoder.write(data));
   });

   socket.on('end',function(){
      console.log('socket从客户端被关闭了');
   });
});

server.listen(12315);

</code></pre></div><ol start="2"><li>Socket 的建立
Socket 是对 TCP/IP 协议族的一种封装。客户端通讯套接字是 net.Socket 的实例，通过调用实例方法 socket.connect(args)来和服务器建立连接，作为客户端通讯套接字时需要监听端口号，建立连接后，客户端 server 通过 connection 事件的回调函数就可以拿到发起连接的 socket 实例，这样客户端和服务器就可以通讯了，其中一方通过 socket.write（）方法写入数据，另一方注册的监听器 socket.on('data',onData)回调函数就会收到信息。socket 实例化示例如下:</li></ol> <div class="language- extra-class"><pre class="language-text"><code>const net = require('net');

let socket = new net.Socket();
socket.connect(12315);
//连接服务器
socket.on('connect',c=&gt;{
   console.log('成功建立和12315的连接')
   setTimeout(()=&gt;{
       console.log('建立连接1s后发送消息');
       socket.write('SN:1231512315','utf8',function(){
           console.log('消息已发送');
       });
   },1000);
});

socket.on('data',function(resp){
   console.log('收到服务器返回消息：',resp);
});

socket.on('end',function(){
   console.log('socket从客户端被关闭了');
})
</code></pre></div><ol start="3"><li>IPC 通讯
IPC 通讯是指 Inter Process Communication，也就是跨进程通讯，上一节在提到 cluster 时已经介绍过进程之间是资源隔离的，所以跨进程通讯也需要通过 net 模块来建立消息管道。它的用法比较简单，只需要将 server.listen( )和 socket.connect( )的参数从端口号换成地址字符串就可以了。示例代码如下：</li></ol> <div class="language- extra-class"><pre class="language-text"><code>const net = require('net');
const cluster = require('cluster');
const path = require('path');
const { StringDecoder } = require('string_decoder');

let serverForIPC;//作为子进程的server

if (cluster.isMaster) {
   //主进程执行逻辑
   setupMaster();
   cluster.fork();//生成子进程
   cluster.fork();//生成另一个子进程
} else {
   //子进程执行逻辑
   setupWorker();
}

//主进程逻辑
function setupMaster() {
   //作为Server监听子进程消息
  let decoder = new StringDecoder('utf8');
   //windows系统中要求的IPC通讯命名规则
  let ipcPath = path.join('\\\\?\\pipe', process.cwd(), 'dashipc');
  serverForIPC = net.createServer(socket=&gt;{
       console.log(`[master]:子进程通过ipcServer连接到主进程`);
       socket.on('data',data=&gt;{
           console.log('[master]:收到来自子进程的消息:',decoder.write(data));
       });
  });
  //IPC-server端监听指定地址
  serverForIPC.listen(ipcPath);
}

//子进程逻辑
function setupWorker() {
   let ipcPath = path.join('\\\\?\\pipe', process.cwd(), 'dashipc');
   let socket = new net.Socket();
   //子进程的socket连接主进程中监听的地址
   socket.connect(ipcPath,c=&gt;{
       console.log(`[child-${process.pid}]:pid为${process.pid}的子进程已经连接到主进程`);
       //过一秒后发个消息测试一下
       setTimeout(()=&gt;{
          socket.write(`${process.pid}的消息:SN1231512315`,'utf8',function(){
             console.log(`[child-${process.pid}]:消息已发送`);
          });
       },1000);
   });
}
</code></pre></div><h2 id="express-模块"><a href="#express-模块" class="header-anchor">#</a> express 模块</h2> <h3 id="基本使用"><a href="#基本使用" class="header-anchor">#</a> 基本使用</h3> <ol><li>创建 web 服务器</li> <li>处理请求</li> <li>托管静态资源
使用 express.static()可以创建一个静态服务器</li></ol> <div class="language- extra-class"><pre class="language-text"><code>const express = require('express')
const app = express()
// 在这里，调用 express.static() 方法，快速的对外提供静态资源
app.use('/files', express.static('./files'))
app.use(express.static('./clock'))
app.listen(80, () =&gt; {
  console.log('express server running at http://127.0.0.1')
})
</code></pre></div><ol start="4"><li>使用 nodemon 工具，它能够监听项目文件的变动，当代码被修改后，nodemon 会自动重启项目，极大方便了开发和调试。</li></ol> <h3 id="express-路由"><a href="#express-路由" class="header-anchor">#</a> Express 路由</h3> <ol><li>把路由挂载到app上</li></ol> <div class="language- extra-class"><pre class="language-text"><code>const express = require('express')
const app = express()
// 挂载路由
app.get('/', (req, res) =&gt; {res.send('hello world.')})
app.post('/', (req, res) =&gt; {res.send('Post Request.')})
app.listen(80, () =&gt; {console.log('express server running at http://127.0.0.1')})
</code></pre></div><ol start="2"><li>模块化路由：为了方便对路由进行模块化的管理，Express 不建议将路由直接挂载到 app 上，而是推荐将路由抽离为单独的模块。将路由抽离为单独模块的步骤如下：</li></ol> <ul><li>创建路由模块对应的 .js 文件</li> <li>调用 express.Router() 函数创建路由对象</li> <li>向路由对象上挂载具体的路由</li> <li>使用 module.exports 向外共享路由对象</li> <li>使用 app.use() 函数注册路由模块</li></ul> <div class="language- extra-class"><pre class="language-text"><code>// 路由模块 router.js
const express = require('express') // 1. 导入 express
const router = express.Router() // 2. 创建路由对象
// 3. 挂载具体的路由
router.get('/user/list', (req, res) =&gt; {res.send('Get user list.')})
router.post('/user/add', (req, res) =&gt; {res.send('Add new user.')})
// 4. 向外导出路由对象
module.exports = router
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>const express = require('express')
const router = require('./router') // 1. 导入路由模块
const app = express()
// 注意： app.use() 函数的作用，就是来注册全局中间件
// app.use('/files', express.static('./files'))
app.use('/api', router) // 2. 注册路由模块，跟使用静态资源一样可以加统一的访问前缀
app.listen(80, () =&gt; {console.log('http://127.0.0.1')})
</code></pre></div><h3 id="express-中间件"><a href="#express-中间件" class="header-anchor">#</a> Express 中间件</h3> <p>当一个请求到达 Express 的服务器之后，可以连续调用多个中间件，从而对这次请求进行预处理。多个中间件之间，共享同一份 req和 res。基于这样的特性，我们可以在上游的中间件中，统一为 req 或
res 对象添加自定义的属性或方法，供下游的中间件或路由进行使用。</p> <ol><li><p>全局中间件，app.use(中间件函数)</p></li> <li><p>局部中间件</p></li></ol> <div class="language- extra-class"><pre class="language-text"><code>const express = require('express')
const app = express()
// 1. 定义中间件函数
const mw1 = (req, res, next) =&gt; {
 console.log('调用了局部生效的中间件')
 next()
}
const mw2 = (req, res, next) =&gt; {
 console.log('调用了第二个局部生效的中间件')
 next()
}
// 2. 创建路由
app.get('/', mw1, nw2, (req, res) =&gt; {res.send('Home page.')})
app.get('/user', [mw1, mw2],(req, res) =&gt; {res.send('User page.')})
app.listen(80, function () {console.log('Express server running at http://127.0.0.1')})

</code></pre></div><p><strong>中间件的5个使用注意事项</strong>
1 一定要在<strong>路由之前注册</strong>中间件
2 客户端发送过来的请求，可以连续调用多个中间件进行处理
3 执行完中间件的业务代码之后，<strong>不要忘记调用 next() 函数</strong>
4 为了防止代码逻辑混乱，调用 next() 函数后不要再写额外的代码
5 连续调用多个中间件时，多个中间件之间，共享req 和 res 对象</p></div></section> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/joyholmes-web-blog/javascript/js.html" class="prev">
          js基本知识
        </a></span> <span class="next"><a href="/joyholmes-web-blog/vue/vue.html">
          vue基本知识
        </a></span></p></div> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-b57cc07c data-v-7dd95ae2><li class="level-2" data-v-b57cc07c><a href="/joyholmes-web-blog/javascript/nodejs.html#nodejs-的事件循环" class="sidebar-link reco-side-nodejs-的事件循环" data-v-b57cc07c>nodejs 的事件循环</a></li><li class="level-2" data-v-b57cc07c><a href="/joyholmes-web-blog/javascript/nodejs.html#js-消息队列" class="sidebar-link reco-side-js-消息队列" data-v-b57cc07c>js 消息队列</a></li><li class="level-2" data-v-b57cc07c><a href="/joyholmes-web-blog/javascript/nodejs.html#node-常用內置模块" class="sidebar-link reco-side-node-常用內置模块" data-v-b57cc07c>node 常用內置模块</a></li><li class="level-3" data-v-b57cc07c><a href="/joyholmes-web-blog/javascript/nodejs.html#fs-文件系统模块" class="sidebar-link reco-side-fs-文件系统模块" data-v-b57cc07c>fs 文件系统模块</a></li><li class="level-3" data-v-b57cc07c><a href="/joyholmes-web-blog/javascript/nodejs.html#path-路径模块" class="sidebar-link reco-side-path-路径模块" data-v-b57cc07c>path 路径模块</a></li><li class="level-3" data-v-b57cc07c><a href="/joyholmes-web-blog/javascript/nodejs.html#http-模块" class="sidebar-link reco-side-http-模块" data-v-b57cc07c>http 模块</a></li><li class="level-3" data-v-b57cc07c><a href="/joyholmes-web-blog/javascript/nodejs.html#net-模块" class="sidebar-link reco-side-net-模块" data-v-b57cc07c>net 模块</a></li><li class="level-2" data-v-b57cc07c><a href="/joyholmes-web-blog/javascript/nodejs.html#express-模块" class="sidebar-link reco-side-express-模块" data-v-b57cc07c>express 模块</a></li><li class="level-3" data-v-b57cc07c><a href="/joyholmes-web-blog/javascript/nodejs.html#基本使用" class="sidebar-link reco-side-基本使用" data-v-b57cc07c>基本使用</a></li><li class="level-3" data-v-b57cc07c><a href="/joyholmes-web-blog/javascript/nodejs.html#express-路由" class="sidebar-link reco-side-express-路由" data-v-b57cc07c>Express 路由</a></li><li class="level-3" data-v-b57cc07c><a href="/joyholmes-web-blog/javascript/nodejs.html#express-中间件" class="sidebar-link reco-side-express-中间件" data-v-b57cc07c>Express 中间件</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/joyholmes-web-blog/assets/js/app.7eb37b69.js" defer></script><script src="/joyholmes-web-blog/assets/js/3.ccf8db39.js" defer></script><script src="/joyholmes-web-blog/assets/js/1.3b1cd4a9.js" defer></script><script src="/joyholmes-web-blog/assets/js/14.e65b058a.js" defer></script>
  </body>
</html>
