<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>项目相关 | JoyHolmes博客</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="前端学习笔记">
    
    <link rel="preload" href="/joyholmes-web-blog/assets/css/0.styles.1cb4ca87.css" as="style"><link rel="preload" href="/joyholmes-web-blog/assets/js/app.7eb37b69.js" as="script"><link rel="preload" href="/joyholmes-web-blog/assets/js/3.ccf8db39.js" as="script"><link rel="preload" href="/joyholmes-web-blog/assets/js/1.3b1cd4a9.js" as="script"><link rel="preload" href="/joyholmes-web-blog/assets/js/20.282eab32.js" as="script"><link rel="prefetch" href="/joyholmes-web-blog/assets/js/10.2899f87d.js"><link rel="prefetch" href="/joyholmes-web-blog/assets/js/11.2b5d8072.js"><link rel="prefetch" href="/joyholmes-web-blog/assets/js/12.667c80ee.js"><link rel="prefetch" href="/joyholmes-web-blog/assets/js/13.1bd247e4.js"><link rel="prefetch" href="/joyholmes-web-blog/assets/js/14.e65b058a.js"><link rel="prefetch" href="/joyholmes-web-blog/assets/js/15.6e2edf41.js"><link rel="prefetch" href="/joyholmes-web-blog/assets/js/16.d15163d9.js"><link rel="prefetch" href="/joyholmes-web-blog/assets/js/17.521d5855.js"><link rel="prefetch" href="/joyholmes-web-blog/assets/js/18.f3d93d71.js"><link rel="prefetch" href="/joyholmes-web-blog/assets/js/19.147524ef.js"><link rel="prefetch" href="/joyholmes-web-blog/assets/js/21.6a9bc17b.js"><link rel="prefetch" href="/joyholmes-web-blog/assets/js/22.1a0b77b3.js"><link rel="prefetch" href="/joyholmes-web-blog/assets/js/23.68f1a384.js"><link rel="prefetch" href="/joyholmes-web-blog/assets/js/24.38074801.js"><link rel="prefetch" href="/joyholmes-web-blog/assets/js/25.efe8443f.js"><link rel="prefetch" href="/joyholmes-web-blog/assets/js/26.2e0b268a.js"><link rel="prefetch" href="/joyholmes-web-blog/assets/js/27.8585f5bb.js"><link rel="prefetch" href="/joyholmes-web-blog/assets/js/4.d4d7a181.js"><link rel="prefetch" href="/joyholmes-web-blog/assets/js/5.e0a97d89.js"><link rel="prefetch" href="/joyholmes-web-blog/assets/js/6.8d6a2560.js"><link rel="prefetch" href="/joyholmes-web-blog/assets/js/7.1d99cced.js"><link rel="prefetch" href="/joyholmes-web-blog/assets/js/8.ba57595f.js"><link rel="prefetch" href="/joyholmes-web-blog/assets/js/9.7a493893.js">
    <link rel="stylesheet" href="/joyholmes-web-blog/assets/css/0.styles.1cb4ca87.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-7dd95ae2><div data-v-7dd95ae2><div class="password-shadow password-wrapper-out" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>JoyHolmes博客</h3> <p class="description" data-v-59e6cb88>前端学习笔记</p> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><!---->
          
        <!---->
        2023
      </a></span></div></div> <div class="hide" data-v-7dd95ae2><header class="navbar" data-v-7dd95ae2><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/joyholmes-web-blog/" class="home-link router-link-active"><!----> <span class="site-name">JoyHolmes博客</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/joyholmes-web-blog/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      JoyHolmes的博客
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/joyholmes" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-7dd95ae2></div> <aside class="sidebar" data-v-7dd95ae2><div class="personal-info-wrapper" data-v-1fad0c41 data-v-7dd95ae2><!----> <!----> <div class="num" data-v-1fad0c41><div data-v-1fad0c41><h3 data-v-1fad0c41>18</h3> <h6 data-v-1fad0c41>文章</h6></div> <div data-v-1fad0c41><h3 data-v-1fad0c41>0</h3> <h6 data-v-1fad0c41>标签</h6></div></div> <ul class="social-links" data-v-1fad0c41></ul> <hr data-v-1fad0c41></div> <nav class="nav-links"><div class="nav-item"><a href="/joyholmes-web-blog/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      JoyHolmes的博客
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/joyholmes" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/joyholmes-web-blog/" class="sidebar-heading clickable router-link-active"><span>欢迎学习</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/joyholmes-web-blog/" aria-current="page" class="sidebar-link">学前必读</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/joyholmes-web-blog/network/network" class="sidebar-heading clickable"><span>前端网络知识</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/joyholmes-web-blog/network/network.html" class="sidebar-link">前端网络</a></li><li><a href="/joyholmes-web-blog/network/browser.html" class="sidebar-link">浏览器知识</a></li><li><a href="/joyholmes-web-blog/network/http.html" class="sidebar-link">http相关</a></li><li><a href="/joyholmes-web-blog/network/linux.html" class="sidebar-link">常用Linux命令</a></li><li><a href="/joyholmes-web-blog/network/websocket.html" class="sidebar-link">WebSocket</a></li><li><a href="/joyholmes-web-blog/network/axios.html" class="sidebar-link">axios</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/joyholmes-web-blog/htmlcss/html" class="sidebar-heading clickable"><span>html&amp;css查漏补缺</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/joyholmes-web-blog/htmlcss/html.html" class="sidebar-link">html</a></li><li><a href="/joyholmes-web-blog/htmlcss/css.html" class="sidebar-link">css</a></li><li><a href="/joyholmes-web-blog/htmlcss/css2.html" class="sidebar-link">常用前端布局</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/joyholmes-web-blog/javascript/js" class="sidebar-heading clickable"><span>js查漏补缺</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/joyholmes-web-blog/javascript/js.html" class="sidebar-link">js基本知识</a></li><li><a href="/joyholmes-web-blog/javascript/nodejs.html" class="sidebar-link">node</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/joyholmes-web-blog/vue/vue" class="sidebar-heading clickable"><span>vue</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/joyholmes-web-blog/vue/vue.html" class="sidebar-link">vue基本知识</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/joyholmes-web-blog/web/webpack" class="sidebar-heading clickable"><span>前端工程化</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/joyholmes-web-blog/web/webpack.html" class="sidebar-link">webpack</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/joyholmes-web-blog/ts/typescript" class="sidebar-heading clickable"><span>TypeScript</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/joyholmes-web-blog/ts/typescript.html" class="sidebar-link">TypeScript</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/joyholmes-web-blog/project/project" class="sidebar-heading clickable open active"><span>项目相关内容</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/joyholmes-web-blog/project/project.html" aria-current="page" class="active sidebar-link">项目优化</a></li><li><a href="/joyholmes-web-blog/project/others.html" class="sidebar-link">其他内容</a></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>项目相关</h3> <!----> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><!---->
          
        <!---->
        2023
      </a></span></div></div> <div data-v-7dd95ae2><div data-v-7dd95ae2><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">项目相关</h1> <div data-v-8a445198><i class="iconfont reco-account" data-v-8a445198><span data-v-8a445198>JoyHolmes</span></i> <i class="iconfont reco-date" data-v-8a445198><span data-v-8a445198>2023/11/2</span></i> <!----> <!----></div></div> <div class="theme-reco-content content__default"><h1 id="项目相关"><a href="#项目相关" class="header-anchor">#</a> 项目相关</h1> <h2 id="封装网络请求"><a href="#封装网络请求" class="header-anchor">#</a> 封装网络请求</h2> <ol><li>使用拦截器对请求和相应进行处理</li></ol> <div class="language- extra-class"><pre class="language-text"><code>  axios.interceptors.response.use(
    (res:any) =&gt; {
        return Promise.resolve(res);
    },
    (error: any) =&gt; {
        if (error.response.status &amp;&amp; error.response.status  == &quot;401&quot;) {
            Vue.prototype.$message.closeAll();
            Vue.prototype.$message({
                type: 'warning',
                message: &quot;长时间未操作,需要重新登录!&quot;
            });
            window.sessionStorage.setItem(&quot;token&quot;, &quot;&quot;);
            router.replace(&quot;/&quot;);
            console.clear();
            return;
        }
        return Promise.resolve(error.response);
    }
  );
</code></pre></div><ol start="2"><li>设置通用的配置，添加到每一个请求(baseURL, timeout)</li></ol> <div class="language- extra-class"><pre class="language-text"><code>  abstract class ServiceBase {
    private static globalSource: CancelTokenSource = axios.CancelToken.source();
    public static config: AxiosRequestConfig = {
        baseURL: (window as any).facilityParams.serverUrl,
        timeout: 10000,
        cancelToken: ServiceBase.globalSource.token
    };

    private static _serviceHandler(res: any) {
        let msg = &quot;&quot;;
        if (!res) {
            msg = &quot;无响应结果&quot;;
            console.log(msg);
            return null;
        }
        if (res.data &amp;&amp; res.data.hasError) {
            msg = `错误信息${res.data.message}`;
            console.log(msg);
            return null;
        }
        return res.data;
    }

    protected static _post&lt;T&gt;(url: string, data?: any, config?: AxiosRequestConfig): Promise&lt;T&gt; {
        return axios
            .post(url, data, { ...ServiceBase.config, ...config })
            .then(ServiceBase._serviceHandler)
            .catch((err: any) =&gt; {
                const msg = `请求${url}出错`;
                console.error(msg, err);
            });
    }

    protected static _download&lt;T&gt;(url: string, params: any) {
        const devMode = process.env.NODE_ENV === &quot;development&quot;;
        if(devMode){
            window.open(&quot;http://localhost:8008&quot; + &quot;/&quot; + url + `/?${qs.stringify(params)}`);
        } else {
            window.open((window as any).facilityParams.facilityServerUrl + &quot;/&quot; + url + `/?${qs.stringify(params)}`);
        }
    }
  }
</code></pre></div><ol start="3"><li>请求调用</li></ol> <div class="language- extra-class"><pre class="language-text"><code>  import ServiceBase from &quot;./service-base&quot;;
  import qs from &quot;qs&quot;;
  class PumpStationService extends ServiceBase {
      static getRegionList(params: any) {
          return this._get(`/home/dr/region/type?${qs.stringify(params)}`);
      }
      static pumpStationAdd(params: any) {
          return this._post(`/home/dr/pumpstation/add`, params);
      }
      static pumpStationUpdate(params: any) {
          return this._post(`/home/dr/pumpstation/update`, params);
      }
      static pumpStationDelete(params: any) {
          return this._post(`/home/dr/pumpstation/delete?${qs.stringify(params)}`, {});
      }
  }
  export default PumpStationService;
</code></pre></div><h2 id="打包优化"><a href="#打包优化" class="header-anchor">#</a> 打包优化</h2> <p><a href="https://juejin.cn/post/6844904093463347208#heading-12" target="_blank" rel="noopener noreferrer">带你深度解锁 Webpack 系列(优化篇)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <blockquote><p>vue-cli-service build --report 获取打包 bundle 信息</p></blockquote> <h3 id="ignoreplugin-优化"><a href="#ignoreplugin-优化" class="header-anchor">#</a> <strong>IgnorePlugin 优化</strong></h3> <p>webpack  的内置插件，作用是忽略第三方包指定目录。例如: moment (2.24.0 版本)  会将所有本地化内容和核心功能一起打包，我们就可以使用  IgnorePlugin  在打包时忽略本地化内容。（优化打包体积）以 drainageMonitor 为例，使用该方法可以微弱减小打包体积。(19.3--&gt;18.9)</p> <div class="language- extra-class"><pre class="language-text"><code>let Webpack = require('webpack');
plugins:[
	new Webpack.IgnorePlugin(/\.\/locale/,/moment/),//moment这个库中，如果引用了./locale/目录的内容，就忽略掉，不会打包进去
]
</code></pre></div><p>我们虽然按照上面的方法忽略了包含’./locale/'该字段路径的文件目录,但是也使得我们使用的时候不能显示中文语言了，所以这个时候可以手动引入中文语言的目录</p> <div class="language- extra-class"><pre class="language-text"><code>import moment from 'moment'

//设置语言

//手动引入所需要的语言包
import 'moment/locale/zh-cn';

moment.locale('zh-cn');

let r = moment().endOf('day').fromNow();
console.log(r);

</code></pre></div><h3 id="externals-使用-cdn-加速优化"><a href="#externals-使用-cdn-加速优化" class="header-anchor">#</a> <strong>externals 使用 CDN  加速优化</strong></h3> <p>cdn 优化是指把第三方库比如（vue，vue-router，axios）通过 cdn 的方式引入项目中，这样 vendor.js 会显著减少，并且大大提升项目的首页加载速度。
     使用该方法可以极大地优化打包体积。还是以 drainageMonitor 为例将下面几个模块使用 CDN 优化，打包体积几乎缩小到一半。目前使用该方法打包的前端代码可以正常运行，但须进一步测试具体功能，以及解决不同版本的 npm 包可能带来的问题，所以暂未提交代码。(18.9--&gt;11.2)</p> <div class="language- extra-class"><pre class="language-text"><code>//webpack.config.js
  module.exports = {
      //...
      externals: {
          //jquery通过script引入之后，全局中即有了 jQuery 变量
          'jquery': 'jQuery'
      }
  }

  'vue': 'Vue',
  &quot;element-ui&quot;: &quot;ELEMENT&quot;,
  'vue-router': 'VueRouter',
  'axios': 'axios',
  'echarts': 'echarts',
</code></pre></div><p>打包之后查看相关请求，相同网络条件下使用 cdn 优化打包的 echarts.js 请求时间为 287 毫秒，使用原来方式请求单独打包的 echarts.js 请求时间为 1.09 秒，请求时间优化效果也非常明显。</p> <p>可以使用该方法将 report.html 中体积较大的其他引用（xlsx，yxg-xlsx-style）进一步优化打包体积。同时，可以看到几乎每个 js 打包文件中都有 jquery，并且所占体积也不小，可以将 jquery 进行单独打包优化，或者使用 cdn 方式优化。</p> <blockquote><p>项目使用了线上开源的 CDN 却因为服务不稳定导致了团队项目出现问题的情况,在一次迭代中统一替换成了 webpack-dll-plugin</p></blockquote> <h3 id="npm-run-dll-优化打包速度"><a href="#npm-run-dll-优化打包速度" class="header-anchor">#</a> <strong>npm run dll(优化打包速度)</strong></h3> <ol><li>dll 优化原理:
每次打包都会处理所有的内容，但是并不更改第三方包(vue/jquery/axios 等等),那么 dll 先打包第三方报，告诉真正的包那些第三方包已经被处理了，下次就不用再打包了</li> <li>在 build 文件下新建一个 webpack.dll.js 文件,
内容如下</li></ol> <div class="language- extra-class"><pre class="language-text"><code>const path = require(&quot;path&quot;)
const webpack = require(&quot;webpack&quot;)
module.exports = {
    entry:{
        vendor:['vue/dist/vue.esm','vue-router','axios','jquery']
    },
    output:{
        path:path.join(__dirname,'../static/js'),
        filename:'[name].dll.js',
        library:'[name]_library'
    },
    plugins:[
        new webpack.DllPlugin({
            path:path.join(__dirname,&quot;../static/js/vendor-manifest.json&quot;),
            name:&quot;[name]_library&quot;
        })
    ]
}
</code></pre></div><p>npm run dll
npm run build</p> <h3 id="提取第三方库-公共代码-optimization-splitchunks"><a href="#提取第三方库-公共代码-optimization-splitchunks" class="header-anchor">#</a> <strong>提取第三方库(公共代码)---optimization.splitChunks</strong></h3> <p>由于引入的第三方库一般都比较稳定，不会经常改变。所以将它们单独提取出来，作为长期缓存是一个更好的选择。 这里需要使用 webpack4 的 splitChunk 插件 cacheGroups 选项。</p> <div class="language- extra-class"><pre class="language-text"><code>  config.optimization.splitChunks({
  chunks: &quot;all&quot;,
  cacheGroups: {
      // 单独优化xlsx依赖，使之只打包一次,
      xlsx: {
          name: &quot;xlsx&quot;,
          test: /[\\/]node_modules[\\/]xlsx[\\/]/,
          minSize: 0,
          minChunks: 1,
          reuseExistingChunk: true,
          chunks: &quot;all&quot;
      },
      yxgxlsxstyle: {
          name: &quot;yxg-xlsx-style&quot;,
          test: /[\\/]node_modules[\\/]yxg-xlsx-style[\\/]/,
          minSize: 0,
          minChunks: 1,
          reuseExistingChunk: true,
          chunks: &quot;all&quot;
      },
      elementUI: {
          name: &quot;chunk-elementUI&quot;, // 单独将 elementUI 拆包
          priority: 20, // 权重要大于 libs 和 app 不然会被打包进 libs 或者 app
          test: /[\\/]node_modules[\\/]element-ui[\\/]/
      },
      echarts: {
          name: &quot;chunk-echarts&quot;, // 单独将 echarts 拆包
          priority: 20, // 权重要大于 libs 和 app 不然会被打包进 libs 或者 app
          test: /[\\/]node_modules[\\/]echarts[\\/]/
      }
  }
});
</code></pre></div><ul><li>test: 用于控制哪些模块被这个缓存组匹配到。原封不动传递出去的话，它默认会选择所有的模块。可以传递的值类型：RegExp、String 和 Function;</li> <li>priority：表示抽取权重，数字越大表示优先级越高。因为一个 module 可能会满足多个 cacheGroups 的条件，那么抽取到哪个就由权重最高的说了算；</li> <li>reuseExistingChunk：表示是否使用已有的 chunk，如果为 true 则表示如果当前的 chunk 包含的模块已经被抽取出去了，那么将不会重新生成新的。</li> <li>minChunks（默认是 1）：在分割之前，这个代码块最小应该被引用的次数（译注：保证代码块复用性，默认配置的策略是不需要多次引用也可以被分割）</li> <li>chunks (默认是 async) ：initial、async 和 all</li> <li>name(打包的 chunks 的名字)：字符串或者函数(函数可以根据条件自定义名字)</li></ul> <h2 id="文件上传下载预览"><a href="#文件上传下载预览" class="header-anchor">#</a> 文件上传下载预览</h2> <h3 id="文件上传"><a href="#文件上传" class="header-anchor">#</a> 文件上传</h3> <div class="language- extra-class"><pre class="language-text"><code>  //文件上传
  &lt;div class=&quot;equip-upload&quot;  v-if=&quot;!editFlag&quot;&gt;
      &lt;el-upload
          ref=&quot;upload1&quot;
          class=&quot;upload-btn&quot;
          :auto-upload=&quot;false&quot;
          :data=&quot;uploadData1&quot;
          :action=&quot;uploadUrl&quot;
          name=&quot;files&quot;
          :limit=&quot;1&quot;
          :on-exceed=&quot;handleExceed&quot;
          :headers=&quot;setUploadHeader&quot;
          :on-error=&quot;handleUploadError&quot;
          :before-remove=&quot;beforeRemove1&quot;
          :on-change=&quot;onChange&quot;
          :file-list=&quot;fileList1&quot;
          :before-upload=&quot;beforeFileUpload&quot;
      &gt;
          &lt;el-button style=&quot;border: #3388ff 1px solid&quot; plain icon=&quot;el-icon-upload2&quot;&gt;点击上传&lt;/el-button&gt;
      &lt;/el-upload&gt;
  &lt;/div&gt;

  protected handleUploadError() {
        this.$message.error(&quot;上传附件失败!&quot;);
    }

    protected beforeRemove1(file: any, fileList: any) {
        if (file.mediaID) {
            MediaService.deleteMedia({ mediaID: file.mediaID })
                .then((data: any) =&gt; {
                    if (data?.success) {
                        this.$message.success(&quot;附件删除成功&quot;);
                        return;
                    }
                    this.$message.error(&quot;附件删除失败&quot;);
                })
                .catch(() =&gt; {
                    this.$message.error(&quot;附件删除失败&quot;);
                });
        }
        return true;
    }

    protected handleExceed(files: any, fileList: any) {
        this.$message.warning(
            `当前限制选择 1 个文件，本次选择了 ${files.length} 个文件，共选择了 ${files.length + fileList.length} 个文件`
        );
    }

    protected onChange(file: any) {
        const isFileValid = floodReportFileTypeValid(file.name);
        const isLt2M = file.size / 1024 / 1024 &lt; 30;
        const fileName = file.name.split(&quot;.&quot;)[0];
        const isFileNameValid = fileName.length &lt; 100;
        if (!isFileValid) {
            this.$message.error(&quot;不支持上传文件格式!&quot;);
            this.fileList1 = [];
            return;
        }
        if (!isLt2M) {
            this.$message.error(&quot;文件过大!&quot;);
            this.fileList1 = [];
            return;
        }
        if (!isFileNameValid) {
            this.$message.error(&quot;文件名过长！&quot;);
            this.fileList1 = [];
        }
    }

    protected beforeFileUpload(file: any) {
        const isFileValid = floodReportFileTypeValid(file.name);
        const isLt2M = file.size / 1024 / 1024 &lt; 30;
        const fileName = file.name.split(&quot;.&quot;)[0];
        const isFileNameValid = fileName.length &lt; 100;
        if (!isFileValid) {
            this.$message.error(&quot;不支持上传文件格式!&quot;);
        }
        if (!isLt2M) {
            this.$message.error(&quot;文件过大!&quot;);
        }
        if (!isFileNameValid) {
            this.$message.error(&quot;文件名过长！&quot;);
        }
        return isFileValid &amp;&amp; isLt2M &amp;&amp; isFileNameValid;
    }

    //常见文件格式验证
    export function isFileTypeValid(fileName: any) {
        if (fileName == null || fileName == &quot;&quot;) {
            return false;
        }
        if (fileName.lastIndexOf(&quot;.&quot;) == -1) {
            return false;
        }
        const AllExt = &quot;.png|.jpe|.jpeg|.jpg|.gif|.txt|.html|.htm|.csv|.xml|.mp3|.mp4|.doc|.docx|.xls|.xlsx|.ppt|.pptx|.pdf|&quot;;
        const extName = fileName.substring(fileName.lastIndexOf(&quot;.&quot;)).toLowerCase(); //（把路径中的所有字母全部转换为小写）
        if (AllExt.indexOf(extName) == -1) {
            return false;
        } else {
            return true;
        }
    }
</code></pre></div><h3 id="文件预览"><a href="#文件预览" class="header-anchor">#</a> 文件预览</h3> <div class="language- extra-class"><pre class="language-text"><code>    //文件预览
    &lt;el-dialog
        :modal-append-to-body=&quot;false&quot;
        :append-to-body=&quot;false&quot;
        :title=&quot;previewTitle&quot;
        :visible.sync=&quot;dialogVisible&quot;
        :close-on-click-modal=&quot;false&quot;
        class=&quot;edit-dialog&quot;
        :before-close=&quot;closePreview&quot;
        :destroy-on-close=&quot;true&quot;
    &gt;
        &lt;FileWatch :docSrc=&quot;docSrc&quot; :mediaType=&quot;mediaType&quot;&gt;&lt;/FileWatch&gt;
    &lt;/el-dialog&gt;

    protected showPatch() {
        if (!this.rowData.id){
            return;
        }
        const param = { ...{ relationTypeID: this.reportTypeID }, ...{ relationID: this.rowData.id } };
        MediaService.getMedia(param).then((imgData: any) =&gt; {
            this.mediaType = &quot;&quot;;
            if (imgData?.success) {
                const mediaList = imgData?.data?.mediaList || [];
                if (mediaList?.length) {
                    this.docSrc = `${(window as any).facilityParams.facilityServerUrl}/${mediaList[0].mediaURL}`;
                    this.mediaType = this.docSrc.substring(this.docSrc.lastIndexOf(&quot;.&quot;) + 1);
                }
                if (this.mediaType === &quot;xlsx&quot; || this.mediaType === &quot;xls&quot; || this.mediaType === &quot;doc&quot; || this.mediaType === &quot;docx&quot;) {
                    this.formSubmit(this.docSrc);
                } else {
                    this.dialogVisible = true;
                }
            }
        });
    }
    protected formSubmit(url: any) {
        const a = document.createElement(&quot;a&quot;);
        a.style.display = &quot;none&quot;;
        a.href = url;
        a.download = &quot;附件&quot;;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
    }

    //FileWatch.vue
    &lt;el-dialog :title=&quot;previewTitle&quot; :visible.sync=&quot;dialogPdfVisible&quot; class=&quot;g-dialog previewDialog&quot; @close='closePreview'&gt;
        &lt;iframe :src=&quot;docUrl&quot; width=&quot;100%&quot; ref=&quot;previewIframe&quot; height=&quot;100%&quot; v-if=&quot;this.mediaType == 'TEXT'&quot;&gt;&lt;/iframe&gt;
        &lt;el-image style=&quot;width: 100%; height: 100%&quot; :src=&quot;docUrl&quot; fit=&quot;contain&quot; v-if=&quot;this.mediaType == 'IMAGE'&quot;&gt;&lt;/el-image&gt;
        &lt;video
            id=&quot;myVideo&quot;
            class=&quot;video-js vjs-default-skin vjs-big-play-centered&quot;
            controls
            preload=&quot;auto&quot;
            muted
            autoplay=&quot;autoplay&quot;
            style=&quot;width: 100%;height: 100%;object-fit: fill&quot;
            v-if=&quot;this.mediaType == 'VIDEO'&quot;
        &gt;&lt;/video&gt;
        &lt;audio autoplay=&quot;autoplay&quot; 
            controls=&quot;controls&quot;
            preload=&quot;auto&quot;
            v-if=&quot;this.mediaType == 'AUDIO'&quot;
            style=&quot;clear:both;display:block;margin:1.5rem auto&quot;
            :src=&quot;docUrl&quot;&gt;
        &lt;/audio&gt;
    &lt;/el-dialog&gt;
</code></pre></div><h3 id="文件导出"><a href="#文件导出" class="header-anchor">#</a> 文件导出</h3> <div class="language- extra-class"><pre class="language-text"><code>    protected downloadItems() {
        ExportUtils.exportData(this.columns, this.tableData, &quot;重点区域管理&quot;);
    }


    import moment from &quot;moment&quot;;
    import excel from &quot;@/utils/export2Excel&quot;;
    export default class ExportUtils {
        /* 前端导出 */
        public static exportData(columns: any, tableData: any, fieldName: any, timeFields?: any) {
            if (tableData.length == 0) return;
            const header: any = [];
            columns.forEach((item: any) =&gt; {
                header.push(item.label);
            });
            const data: any = tableData.map((v: any) =&gt;
                columns.map((j: any) =&gt; {
                    if(v[j[&quot;field&quot;]] === &quot;&quot; || v[j[&quot;field&quot;]] === null){
                        v[j[&quot;field&quot;]] = &quot;-&quot;;
                    } else if (timeFields &amp;&amp; timeFields?.length &amp;&amp; timeFields.indexOf(j[&quot;field&quot;]) &gt; -1) {
                        v[j[&quot;field&quot;]] =  moment(v[j[&quot;field&quot;]]).format(&quot;YYYY-MM-DD&quot;);
                    }
                    return v[j[&quot;field&quot;]];
                })
            );
            excel.export_json_to_excel({
                header,
                data,
                filename: fieldName + moment().format(&quot;YYYY-MM-DD_HHmmss&quot;),
                autoWidth: true,
                bookType: &quot;xlsx&quot;
            });
        }
    }


    // import XLSX from &quot;xlsx&quot;;
    import XLSX from &quot;yxg-xlsx-style&quot;;
    import moment from &quot;moment&quot;;


</code></pre></div><h2 id="常用内容模块化"><a href="#常用内容模块化" class="header-anchor">#</a> 常用内容模块化</h2> <div class="language- extra-class"><pre class="language-text"><code>  //文件操作模块
  import OperateBtn from &quot;@/components/common/operateBtn/OperateBtn.vue&quot;;

  protected btnList = [
    { name: &quot;新增&quot;, icon: &quot;icon-add&quot;, color: &quot;#3488FF&quot;, showBtn: true, btnClick: this.addItem },
    { name: &quot;编辑&quot;, icon: &quot;icon-edit&quot;, color: &quot;#3488FF&quot;, showBtn: false, btnClick: this.editItem, checkStyle: &quot;single&quot; },
    { name: &quot;删除&quot;, icon: &quot;icon-delete&quot;, color: &quot;#FF4545&quot;, showBtn: false, btnClick: this.deleteItem, checkStyle: &quot;multiple&quot; },
    { name: &quot;下载模板&quot;, icon: &quot;icon-daoru&quot;, color: &quot;#3488FF&quot;, showBtn: true, btnClick: this.downloadTemplate },
    { name: &quot;导入&quot;, icon: &quot;icon-import&quot;, color: &quot;#11C79B&quot;, showBtn: true, btnClick: this.importData },
    { name: &quot;导出&quot;, icon: &quot;icon-download&quot;, color: &quot;#11C79B&quot;, showBtn: true, btnClick: this.downloadItems }
  ];

  &lt;OperateBtn :btnList=&quot;btnList&quot;&gt;&lt;/OperateBtn&gt;


  //通用表格模块
  import TableList from &quot;@/components/test/TableList.vue&quot;;
  &lt;div class=&quot;table-wrap&quot;&gt;
      &lt;TableList :columnList=&quot;columnList&quot; :tableData=&quot;tableData&quot; :total=&quot;total&quot;/&gt;
  &lt;/div&gt;

  @Prop({ type: Array, default: [] })
  protected columns!: any;

  @Prop({ type: Boolean, default: false })
  protected showSelection!: any;

  @Prop({ type: Number, default: 10 })
  protected pageSize!: any;

  @Prop()
  protected serviceBase!: any;

  @Prop({ type: String, default: &quot;&quot; })
  protected urlMethod!: any;

  @Prop({ type: Object, default: {} })
  protected params!: any;


  //通用菜单模块
  import Menus from &quot;@/components/common/leftMenu/LeftMenu.vue&quot;;

  &lt;aside&gt;
      &lt;Menus :menusList=&quot;menusList&quot; :collapse=&quot;collapse&quot;&gt;&lt;/Menus&gt;
  &lt;/aside&gt;


</code></pre></div><h2 id="videojs播放视频"><a href="#videojs播放视频" class="header-anchor">#</a> videojs播放视频</h2> <p>前端在浏览器显示摄像头传回的RTSP视频流，我和后端都没做过视频流的项目，所以一步步摸索过来，方法和经验供大家参考。前端采用的技术有VUE+video.js+flv.js</p> <p><img src="/joyholmes-web-blog/assets/img/20210427092235823.bc1f876e.png" alt=""></p> <p><strong>几种视频流的播放方法</strong></p> <ol><li>RTSP</li></ol> <p>从上图可以看出，RTSP流不能直接在浏览器播放，所以需要转码：</p> <ol start="2"><li>RTSP转RTMP</li></ol> <p>RTMP的流需要在浏览器中用flash播放器，但是谷歌已经在2020年底带头不支持flash插件了</p> <ol start="3"><li>RTSP转HLS(视频中台)</li></ol> <p>后端将视频转成HLS流，以m3u8后缀结尾。通过浏览器用video.js可以正常播放，但是发现和原视频存在5秒左右的延迟，不符合项目的实时性需求，所以有实时视频的需求不建议用HLS流播放。下面提供几个HLS的测试地址：
http://ivi.bupt.edu.cn/hls/cctv1hd.m3u8（CCTV-1到CCTV-14，改为相应cctv1hd就可以）
http://ivi.bupt.edu.cn/hls/hunanhd.m3u8（湖南卫视高清）
http://ivi.bupt.edu.cn/hls/btv1hd.m3u8（北京卫视高清）</p> <ol start="4"><li>RTSP转FLV</li></ol> <p>经过和后端不断讨论，最后决定用RTSP转flv格式的方案来播放视频。flv.js是一个较成熟的前端处理flv格式的插件库，是B站视频的开源插件。</p> <h2 id="动态路由"><a href="#动态路由" class="header-anchor">#</a> 动态路由</h2> <ol><li>根据seniorItemName和humanID向后台获取路由相关数据</li></ol> <div class="language- extra-class"><pre class="language-text"><code>  const humannavPromise: any = humannav({
      fn:(view:string)=&gt;{
          return () =&gt; import(`@/views/landscaping/${view}.vue`);
      },
      seniorItemName:&quot;lsgreenland&quot;
  });
  humannavPromise.then((router: any) =&gt; {
      new Vue({
          router,
          store,
          render: h =&gt; h(App)
      }).$mount(&quot;#app&quot;);
  })

  navdata = await CommonService.humannav({ seniorItemName: seniorName });

</code></pre></div><ol start="2"><li>根据返回的数据构造appMenu</li></ol> <div class="language- extra-class"><pre class="language-text"><code>  const { router } = getAppMenu({ humanNavBarItems, extraNav: obj.extraNav });

    // 获取一级菜单
    const virtualRoutes: any = [];
    const rootObj = getRoot(humanNavBarItems);

    humanNavBarItems.forEach((item: any) =&gt; {
        if (item.seniorID == rootObj.navItemID &amp;&amp; item.navItemName) {
            virtualRoutes.push(item);
        }
    });

    // 根据后台获取的一级菜单对象，构造真实的一级路由
    virtualRoutes.forEach((virtualRoute: any) =&gt; {
        const routeObj = createRouteObj(virtualRoute);
        realRoutes.push(routeObj);
    });

    //遍历真实一级菜单，构造真实二级、三级等子菜单
    realRoutes.forEach((realRoute: any) =&gt; {
        generateAllRoutes(realRoute, humanNavBarItems, obj.extraNav);
    });
</code></pre></div><h2 id="scss-mixin-scss"><a href="#scss-mixin-scss" class="header-anchor">#</a> scss _mixin.scss</h2> <div class="language- extra-class"><pre class="language-text"><code>    @mixin size($width: 100%, $height: 100%) {
        width: $width;
        height: $height;
    }

    /* --------------------------------------------
    flex布局
    ---------------------------------------------*/
    @mixin flex($row: row, $justify-content: flex-start, $align-items: flex-start, $wrap: nowrap) {
        display: flex;
        flex-flow: $row $wrap;
        justify-content: $justify-content;
        align-items: $align-items;
    }

    /* --------------------------------------------
    省略号
    ---------------------------------------------*/
    @mixin ellipsis() {
        overflow: hidden;
        -ms-text-overflow: ellipsis;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    /* --------------------------------------------
    自定义行数省略号
    ---------------------------------------------*/
    @mixin multiellipsis($line) {
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: $line; //行数
        -webkit-box-orient: vertical;
    }

    /* --------------------------------------------
    绝对定位
    ---------------------------------------------*/
    @mixin absolute($top: unset, $right: unset, $bottom: unset, $left: unset) {
        position: absolute;
        top: $top;
        left: $left;
        bottom: $bottom;
        right: $right;
    }
</code></pre></div><h2 id="首屏优化"><a href="#首屏优化" class="header-anchor">#</a> 首屏优化</h2> <h3 id="打包分析"><a href="#打包分析" class="header-anchor">#</a> 打包分析</h3> <p>在 package.json 中添加命令 &quot;report&quot;: &quot;vue-cli-service build --report&quot;</p> <p>然后命令行执行 npm run report，就会在dist目录下生成一个 report.html 文件，右键浏览器中打开即可看到打包分析报告。</p> <h3 id="路由懒加载"><a href="#路由懒加载" class="header-anchor">#</a> 路由懒加载</h3> <div class="language- extra-class"><pre class="language-text"><code>component: () =&gt; import(&quot;views/home/Home.vue&quot;),
</code></pre></div><h3 id="vue-config-js-修改-productionsourcemap"><a href="#vue-config-js-修改-productionsourcemap" class="header-anchor">#</a> vue.config.js 修改 productionSourceMap</h3> <div class="language- extra-class"><pre class="language-text"><code>productionSourceMap: devMode ? true : false,
</code></pre></div><h3 id="prefetch、preload"><a href="#prefetch、preload" class="header-anchor">#</a> Prefetch、Preload</h3> <blockquote><p><code>&lt;link&gt;</code>标签的rel属性的两个可选值。<br> <strong>Prefetch</strong>，预请求，是为了提示浏览器，用户未来的浏览有可能需要加载目标资源，所以浏览器有可能通过事先获取和缓存对应资源，优化用户体验。<br> <strong>Preload</strong>，预加载，表示用户十分有可能需要在当前浏览中加载目标资源，所以浏览器必须预先获取和缓存对应资源。</p></blockquote> <p>Prefetch、Preload可以在某些场景下可以有效优化用户体验。举些场景:</p> <ol><li>首屏字体、大图加载，CSS中引入字体需要等CSS解析后才会加载，这之前浏览器会使用默认字体，当加载后会替换为自定义字体，导致字体样式闪动，而我们使用Preload提前加载字体后这种情况就好很多了，大图也是如此</li> <li>优惠券的背景图加载，同样CSS中url引用在DOM没挂载之前是不会加载图片的，进入卡包页/收银台时可以提前使用Prefetch加载，这样用户在进行优惠券页就可以立马看到加载完成的图片了</li></ol> <p>Vue-Cli3默认会使用preload-webpack-plugin对chunk资源做preload、prefetch处理，入口文件preload，路由chunk则是prefetch。</p> <p>一般来说不需要做特别处理，如果判断不需要或者需要调整在vue.config.js中配置即可</p> <p>理论上prefetch不会影响加载速度，但实际测试中，是有轻微影响的，不过这个见仁见智，我认为总体体验上还是有所提升的，
类似字体文件这种隐藏在脚本、样式中的首屏关键资源，建议使用preload，移动端流量访问时慎用</p> <h3 id="图片压缩"><a href="#图片压缩" class="header-anchor">#</a> 图片压缩</h3> <p>使用 image-minimizer-webpack-plugin</p> <p><a href="https://xxpromise.gitee.io/webpack5-docs/senior/reduceVolume.html#image-minimizer" target="_blank" rel="noopener noreferrer">Image Minimizer<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="cdn优化"><a href="#cdn优化" class="header-anchor">#</a> CDN优化</h3> <div class="language- extra-class"><pre class="language-text"><code>  //vue.config.js
  configureWebpack: config =&gt; {
    config.resolve = {
      // 使用 CDN 的包不用打包到文件中
      externals: {
        // 这里的 element-ui 是 import xx from yy 中的 yy 包名。ELEMENT 则是文件导出的全局变量名字
        'element-ui': 'ELEMENT',
      },
    },
  },
  chainWebpack: config =&gt; {
    // 添加 CDN 参数到 htmlWebpackPlugin 配置中
    config.plugin('html').tap(args =&gt; {
      args[0].cdn = {
        js: [
          'https://xx.com/CDN/js/index-element-ui@2.13.0.js',
        ],
        css: [
          'https://xx.com/CDN/css/element-ui2.13.0/index.css',
        ],
      };
      return args;
    });
  },

</code></pre></div><p>然后在 index.html 中挂载 CDN</p> <div class="language- extra-class"><pre class="language-text"><code>  &lt;!DOCTYPE html&gt;
  &lt;html lang=&quot;zh&quot;&gt;
    &lt;head&gt;
      &lt;% for (var i in htmlWebpackPlugin.options.cdn&amp;&amp;htmlWebpackPlugin.options.cdn.css) { %&gt;
      &lt;link href=&quot;&lt;%= htmlWebpackPlugin.options.cdn.css[i] %&gt;&quot; rel=&quot;preload&quot; as=&quot;style&quot;&gt;
      &lt;link href=&quot;&lt;%= htmlWebpackPlugin.options.cdn.css[i] %&gt;&quot; rel=&quot;stylesheet&quot;&gt;
      &lt;% } %&gt;
      &lt;!-- 使用 CDN 加速的 JS 文件，配置在 vue.config.js 下 --&gt;
      &lt;% for (var i in htmlWebpackPlugin.options.cdn&amp;&amp;htmlWebpackPlugin.options.cdn.js) { %&gt;
      &lt;script src=&quot;&lt;%= htmlWebpackPlugin.options.cdn.js[i] %&gt;&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;
      &lt;% } %&gt;
    &lt;/head&gt;
    &lt;body&gt;
      &lt;div id=&quot;app&quot;&gt;&lt;/div&gt;
    &lt;/body&gt;
  &lt;/html&gt;

</code></pre></div><h3 id="公共代码抽离"><a href="#公共代码抽离" class="header-anchor">#</a> 公共代码抽离</h3> <p>splitChunk</p> <h3 id="开启-gzip-压缩"><a href="#开启-gzip-压缩" class="header-anchor">#</a> 开启 gzip 压缩</h3> <div class="language- extra-class"><pre class="language-text"><code>npm install compression-webpack-plugin --save-dev
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>//vue.config.js
const CompressionPlugin = require('compression-webpack-plugin');
 
module.exports = {
  configureWebpack: config =&gt; {
    config.plugins = [
      ...config.plugins,
      // 开启 gzip 压缩
      new CompressionPlugin({
        filename: '[path][base].gz',
        algorithm: 'gzip',
       test: /\.js$|\.html$|\.css$|\.jpg$|\.jpeg$|\.png/, // 需要压缩的文件类型
        threshold: 10240,
        minRatio: 0.8
      })
    ]
  }
}

</code></pre></div><p>nginx要进行相应配置</p> <div class="language- extra-class"><pre class="language-text"><code>http {

   gzip on; # 开启 gzip 压缩
   gzip_static on; # 若存在静态 gz 文件，则使用该文件
   gzip_min_length 10k; # 设置允许压缩的页面最小字节数
   gzip_buffers 16 8k; # 设置用于处理请求压缩的缓冲区数量和大小
   gzip_comp_level 1; # 设置压缩级别 1-9，数字越大，压缩后的大小越小，也越占用CPU，花费时间越长
   # 对特定的 MIME 类型生效, 其中'text/html’被系统强制启用
   gzip_types application/javascript text/css font/ttf font/x-woff;
   gzip_vary on; # 是否在 http header中 添加 Vary:Accept-Encoding, on | off
   gzip_http_version 1.1; # 在 http/1.1 的协议下不开启压缩
}

</code></pre></div><p>资源响应头中出现 Content-Encoding: gzip 则代表配置成功</p> <h2 id="rem布局"><a href="#rem布局" class="header-anchor">#</a> rem布局</h2> <div class="language- extra-class"><pre class="language-text"><code>// 设置echarts文本自适应
  (window as any).pumpScale = document.documentElement.clientWidth / 1920;

  const option: any = {
    grid: [{
        left: 45 * (window as any).pumpScale,
        right: 30 * (window as any).pumpScale,
        top: 30 * (window as any).pumpScale,
        height: '33%'
    }, {
        left: 45 * (window as any).pumpScale,
        right: 30 * (window as any).pumpScale,
        top: '47%',
        height: '33%'
    }]
  }
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>  (function() {
    const baseSize = 1920;
    window.baseSize = baseSize;
    function setRem() {
      let scale = document.documentElement.clientWidth / baseSize;
      document.documentElement.style.fontSize = scale * 100 + &quot;px&quot;;
    }

    setRem();
    window.onresize = function() {
      setRem();
    };
  })();
</code></pre></div><h2 id="其他注意事项"><a href="#其他注意事项" class="header-anchor">#</a> 其他注意事项</h2> <ul><li>public/init.js 中初始化了一些参数存储在 window.facilityParams 中，这些参数会在各模块 main.ts 中进一步初始化</li> <li>提交打包后文件至智云仓库时请删除 report.html</li> <li>编码 ts 时多使用接口（interface），使用明确的类型而不是 any</li> <li>编写 css 时建议多使用混合器（Mixin）和函数</li> <li>在 vue.config.js 中设置开发环境的代理，请不要提交本地代理</li> <li>使用微服务作为后台的模块可能会涉及调用多个后台地址，比如通过代理调用 mis 后台，通过代理调用物联网接口，请注意调用正确的后台地址，相关服务初始化在 util/config.ts 文件里，请仔细阅读</li></ul></div></section> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/joyholmes-web-blog/ts/typescript.html" class="prev">
          TypeScript
        </a></span> <span class="next"><a href="/joyholmes-web-blog/project/others.html">
          其他内容
        </a></span></p></div> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-b57cc07c data-v-7dd95ae2><li class="level-2" data-v-b57cc07c><a href="/joyholmes-web-blog/project/project.html#封装网络请求" class="sidebar-link reco-side-封装网络请求" data-v-b57cc07c>封装网络请求</a></li><li class="level-2" data-v-b57cc07c><a href="/joyholmes-web-blog/project/project.html#打包优化" class="sidebar-link reco-side-打包优化" data-v-b57cc07c>打包优化</a></li><li class="level-3" data-v-b57cc07c><a href="/joyholmes-web-blog/project/project.html#ignoreplugin-优化" class="sidebar-link reco-side-ignoreplugin-优化" data-v-b57cc07c>IgnorePlugin 优化</a></li><li class="level-3" data-v-b57cc07c><a href="/joyholmes-web-blog/project/project.html#externals-使用-cdn-加速优化" class="sidebar-link reco-side-externals-使用-cdn-加速优化" data-v-b57cc07c>externals 使用 CDN  加速优化</a></li><li class="level-3" data-v-b57cc07c><a href="/joyholmes-web-blog/project/project.html#npm-run-dll-优化打包速度" class="sidebar-link reco-side-npm-run-dll-优化打包速度" data-v-b57cc07c>npm run dll(优化打包速度)</a></li><li class="level-3" data-v-b57cc07c><a href="/joyholmes-web-blog/project/project.html#提取第三方库-公共代码-optimization-splitchunks" class="sidebar-link reco-side-提取第三方库-公共代码-optimization-splitchunks" data-v-b57cc07c>提取第三方库(公共代码)---optimization.splitChunks</a></li><li class="level-2" data-v-b57cc07c><a href="/joyholmes-web-blog/project/project.html#文件上传下载预览" class="sidebar-link reco-side-文件上传下载预览" data-v-b57cc07c>文件上传下载预览</a></li><li class="level-3" data-v-b57cc07c><a href="/joyholmes-web-blog/project/project.html#文件上传" class="sidebar-link reco-side-文件上传" data-v-b57cc07c>文件上传</a></li><li class="level-3" data-v-b57cc07c><a href="/joyholmes-web-blog/project/project.html#文件预览" class="sidebar-link reco-side-文件预览" data-v-b57cc07c>文件预览</a></li><li class="level-3" data-v-b57cc07c><a href="/joyholmes-web-blog/project/project.html#文件导出" class="sidebar-link reco-side-文件导出" data-v-b57cc07c>文件导出</a></li><li class="level-2" data-v-b57cc07c><a href="/joyholmes-web-blog/project/project.html#常用内容模块化" class="sidebar-link reco-side-常用内容模块化" data-v-b57cc07c>常用内容模块化</a></li><li class="level-2" data-v-b57cc07c><a href="/joyholmes-web-blog/project/project.html#videojs播放视频" class="sidebar-link reco-side-videojs播放视频" data-v-b57cc07c>videojs播放视频</a></li><li class="level-2" data-v-b57cc07c><a href="/joyholmes-web-blog/project/project.html#动态路由" class="sidebar-link reco-side-动态路由" data-v-b57cc07c>动态路由</a></li><li class="level-2" data-v-b57cc07c><a href="/joyholmes-web-blog/project/project.html#scss-mixin-scss" class="sidebar-link reco-side-scss-mixin-scss" data-v-b57cc07c>scss _mixin.scss</a></li><li class="level-2" data-v-b57cc07c><a href="/joyholmes-web-blog/project/project.html#首屏优化" class="sidebar-link reco-side-首屏优化" data-v-b57cc07c>首屏优化</a></li><li class="level-3" data-v-b57cc07c><a href="/joyholmes-web-blog/project/project.html#打包分析" class="sidebar-link reco-side-打包分析" data-v-b57cc07c>打包分析</a></li><li class="level-3" data-v-b57cc07c><a href="/joyholmes-web-blog/project/project.html#路由懒加载" class="sidebar-link reco-side-路由懒加载" data-v-b57cc07c>路由懒加载</a></li><li class="level-3" data-v-b57cc07c><a href="/joyholmes-web-blog/project/project.html#vue-config-js-修改-productionsourcemap" class="sidebar-link reco-side-vue-config-js-修改-productionsourcemap" data-v-b57cc07c>vue.config.js 修改 productionSourceMap</a></li><li class="level-3" data-v-b57cc07c><a href="/joyholmes-web-blog/project/project.html#prefetch、preload" class="sidebar-link reco-side-prefetch、preload" data-v-b57cc07c>Prefetch、Preload</a></li><li class="level-3" data-v-b57cc07c><a href="/joyholmes-web-blog/project/project.html#图片压缩" class="sidebar-link reco-side-图片压缩" data-v-b57cc07c>图片压缩</a></li><li class="level-3" data-v-b57cc07c><a href="/joyholmes-web-blog/project/project.html#cdn优化" class="sidebar-link reco-side-cdn优化" data-v-b57cc07c>CDN优化</a></li><li class="level-3" data-v-b57cc07c><a href="/joyholmes-web-blog/project/project.html#公共代码抽离" class="sidebar-link reco-side-公共代码抽离" data-v-b57cc07c>公共代码抽离</a></li><li class="level-3" data-v-b57cc07c><a href="/joyholmes-web-blog/project/project.html#开启-gzip-压缩" class="sidebar-link reco-side-开启-gzip-压缩" data-v-b57cc07c>开启 gzip 压缩</a></li><li class="level-2" data-v-b57cc07c><a href="/joyholmes-web-blog/project/project.html#rem布局" class="sidebar-link reco-side-rem布局" data-v-b57cc07c>rem布局</a></li><li class="level-2" data-v-b57cc07c><a href="/joyholmes-web-blog/project/project.html#其他注意事项" class="sidebar-link reco-side-其他注意事项" data-v-b57cc07c>其他注意事项</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/joyholmes-web-blog/assets/js/app.7eb37b69.js" defer></script><script src="/joyholmes-web-blog/assets/js/3.ccf8db39.js" defer></script><script src="/joyholmes-web-blog/assets/js/1.3b1cd4a9.js" defer></script><script src="/joyholmes-web-blog/assets/js/20.282eab32.js" defer></script>
  </body>
</html>
